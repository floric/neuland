<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <style>html, body {
  margin: 0;
  padding: 0;
}

.app {
  margin: 10px;
  padding: 0;
}

.files-list {
  margin: 10px 0 0;
  width: 100%;
  border-collapse: collapse;
}
.files-list__head {
  border: 1px solid #999;
}
.files-list__head > tr > th {
  padding: 10px;
  border: 1px solid #999;
  text-align: left;
  font-weight: normal;
  background: #ddd;
}
.files-list__body {
}
.files-list__file {
  cursor: pointer;
}
.files-list__file:hover {
  background: #ccf;
}
.files-list__file > td {
  padding: 10px;
  border: 1px solid #999;
}
.files-list__file > td:first-child::before {
  content: '\01F4C4';
  margin-right: 1em;
}
.files-list__file_low {
  background: #fcc;
}
.files-list__file_medium {
  background: #ffc;
}
.files-list__file_high {
  background: #cfc;
}
.files-list__file_folder > td:first-child::before {
  content: '\01F4C1';
  margin-right: 1em;
}

.file-header {
  border: 1px solid #999;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.file-header__back {
  margin: 10px;
  cursor: pointer;
  flex-shrink: 0;
  flex-grow: 0;
  text-decoration: underline;
  color: #338;
}

.file-header__name {
  margin: 10px;
  flex-shrink: 2;
  flex-grow: 2;
}

.file-header__stat {
  margin: 10px;
  flex-shrink: 0;
  flex-grow: 0;
}

.file-content {
  margin: 10px 0 0;
  border: 1px solid #999;
  padding: 10px;
}

.code-line {
  margin: 0;
  padding: 0.3em;
  height: 1em;
}
.code-line_covered {
  background: #cfc;
}
.code-line_uncovered {
  background: #fcc;
}
</style>
</head>
<body>
    <div id="root"></div>
    <script>
        var data = {"files":[{"path":["/","home","floric","Dev","Github","rust-tests","graph-db","src","model","attributes.rs"],"content":"use std::collections::HashMap;\nuse std::hash::{Hash, Hasher};\n\n#[derive(Default, Clone, Eq)]\npub struct Attributes {\n    values: HashMap\u003cString, String\u003e,\n}\n\nimpl Attributes {\n    pub fn value_count(\u0026self) -\u003e usize {\n        self.values.len()\n    }\n\n    pub fn get(\u0026self, key: \u0026str) -\u003e Option\u003c\u0026String\u003e {\n        self.values.get(key)\n    }\n\n    pub fn set(\u0026mut self, key: \u0026str, value: String) {\n        self.values.insert(key.to_string(), value);\n    }\n\n    pub fn remove(\u0026mut self, key: \u0026str) {\n        self.values.remove(key);\n    }\n}\n\nimpl Hash for Attributes {\n    fn hash\u003cH: Hasher\u003e(\u0026self, hasher: \u0026mut H) {\n        for att in self.values.iter() {\n            att.hash(hasher);\n        }\n    }\n}\n\nimpl PartialEq for Attributes {\n    fn eq(\u0026self, other: \u0026Self) -\u003e bool {\n        other.values.eq(\u0026self.values)\n    }\n}\n","traces":[{"line":10,"address":[4541808],"length":1,"stats":{"Line":1},"fn_name":"value_count"},{"line":11,"address":[4522233],"length":1,"stats":{"Line":1},"fn_name":null},{"line":14,"address":[4543168],"length":1,"stats":{"Line":3},"fn_name":"get"},{"line":15,"address":[4522291],"length":1,"stats":{"Line":3},"fn_name":null},{"line":18,"address":[4369120,4369198],"length":1,"stats":{"Line":3},"fn_name":"set"},{"line":19,"address":[4369213,4369142],"length":1,"stats":{"Line":6},"fn_name":null},{"line":22,"address":[4369344],"length":1,"stats":{"Line":1},"fn_name":"remove"},{"line":23,"address":[4522627],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[4369408],"length":1,"stats":{"Line":1},"fn_name":"eq"},{"line":37,"address":[4369422],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":10,"coverable":13},{"path":["/","home","floric","Dev","Github","rust-tests","graph-db","src","model","edge.rs"],"content":"use super::attributes::Attributes;\nuse nanoid::nanoid;\nuse std::hash::Hash;\n\n#[derive(Clone, Hash, PartialEq, Eq)]\npub struct Edge {\n    id: String,\n    relation: String,\n    from: String,\n    to: String,\n    attributes: Attributes,\n}\n\nimpl Edge {\n    pub fn new(relation: String, from: String, to: String, attributes: Attributes) -\u003e Edge {\n        Edge {\n            id: nanoid!(),\n            relation,\n            from,\n            to,\n            attributes,\n        }\n    }\n\n    pub fn id(\u0026self) -\u003e \u0026String {\n        \u0026self.id\n    }\n\n    pub fn relation(\u0026self) -\u003e \u0026String {\n        \u0026self.relation\n    }\n\n    pub fn from_id(\u0026self) -\u003e \u0026String {\n        \u0026self.from\n    }\n\n    pub fn to_id(\u0026self) -\u003e \u0026String {\n        \u0026self.to\n    }\n\n    pub fn attributes(\u0026self) -\u003e \u0026Attributes {\n        \u0026self.attributes\n    }\n}\n","traces":[{"line":15,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":17,"address":[4337903],"length":1,"stats":{"Line":4},"fn_name":null},{"line":25,"address":[4557968],"length":1,"stats":{"Line":4},"fn_name":"id"},{"line":26,"address":[4338405],"length":1,"stats":{"Line":3},"fn_name":null},{"line":29,"address":[4557984],"length":1,"stats":{"Line":2},"fn_name":"relation"},{"line":30,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":33,"address":[4338448],"length":1,"stats":{"Line":2},"fn_name":"from_id"},{"line":34,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[4558048],"length":1,"stats":{"Line":2},"fn_name":"to_id"},{"line":38,"address":[4338485],"length":1,"stats":{"Line":2},"fn_name":null},{"line":41,"address":[4338512],"length":1,"stats":{"Line":0},"fn_name":"attributes"},{"line":42,"address":[4338517],"length":1,"stats":{"Line":0},"fn_name":null}],"covered":10,"coverable":12},{"path":["/","home","floric","Dev","Github","rust-tests","graph-db","src","model","graph","mod.rs"],"content":"mod util;\n\nuse super::Attributes;\nuse super::Edge;\nuse super::Node;\nuse std::collections::HashMap;\nuse std::option::Option;\n\n#[derive(Default)]\npub struct Graph {\n    nodes: HashMap\u003cString, Node\u003e,\n    edges: HashMap\u003cString, Edge\u003e,\n    relations: HashMap\u003cString, HashMap\u003cString, String\u003e\u003e,\n}\n\nimpl Graph {\n    pub fn node_count(\u0026self) -\u003e usize {\n        self.nodes.len()\n    }\n\n    pub fn get_node(\u0026self, id: \u0026str) -\u003e Option\u003c\u0026Node\u003e {\n        self.nodes.get(id)\n    }\n\n    pub fn create_node(\u0026mut self, attributes: Attributes) -\u003e \u0026Node {\n        let n = Node::new(attributes);\n        let node_id = n.id().clone();\n        self.nodes.insert(n.id().clone(), n);\n        self.get_node(\u0026node_id).unwrap()\n    }\n\n    pub fn find_by_attribute(\u0026self, key: \u0026str, value: \u0026str) -\u003e Vec\u003c\u0026Node\u003e {\n        self.nodes\n            .values()\n            .filter(|node| -\u003e bool {\n                node.attributes()\n                    .get(key)\n                    .filter(|entry| -\u003e bool { *entry == value })\n                    .is_some()\n            })\n            .collect::\u003cVec\u003c\u0026Node\u003e\u003e()\n    }\n}\n\nimpl Graph {\n    pub fn edge_count(\u0026self) -\u003e usize {\n        self.edges.len()\n    }\n\n    pub fn get_edge(\u0026self, id: \u0026str) -\u003e Option\u003c\u0026Edge\u003e {\n        self.edges.get(id)\n    }\n\n    pub fn create_edge(\n        \u0026mut self,\n        relation: \u0026str,\n        attributes: Attributes,\n        source_id: \u0026str,\n        destination_id: \u0026str,\n    ) -\u003e \u0026Edge {\n        let e = Edge::new(\n            String::from(relation),\n            String::from(source_id),\n            String::from(destination_id),\n            attributes,\n        );\n        let edge_id = e.id().clone();\n        self.edges.insert(e.id().clone(), e);\n\n        let edge = self.edges.get(\u0026edge_id).unwrap();\n\n        let connection_key = util::build_relation_key(source_id, destination_id);\n        let relations_map = self\n            .relations\n            .entry(connection_key)\n            .or_insert_with(HashMap::new);\n\n        relations_map.insert(String::from(relation), edge_id);\n\n        edge\n    }\n\n    pub fn remove_edge(\u0026mut self, edge_id: \u0026str) {\n        let removed_edge = self.edges.remove(edge_id).unwrap();\n        let relation_key = util::build_relation_key(removed_edge.from_id(), removed_edge.to_id());\n        let relations = self.relations.get_mut(\u0026relation_key).unwrap();\n        relations.remove(removed_edge.relation());\n        if relations.is_empty() {\n            self.relations.remove(\u0026relation_key);\n        }\n    }\n\n    pub fn has_any_relation(\u0026self, source_id: \u0026str, destination_id: \u0026str) -\u003e bool {\n        let relation_key = util::build_relation_key(source_id, destination_id);\n        self.relations.contains_key(\u0026relation_key)\n            \u0026\u0026 !self.relations.get(\u0026relation_key).unwrap().is_empty()\n    }\n\n    pub fn has_relation(\u0026self, relation: \u0026str, source_id: \u0026str, destination_id: \u0026str) -\u003e bool {\n        let relation_key = util::build_relation_key(source_id, destination_id);\n        self.relations.contains_key(\u0026relation_key)\n            \u0026\u0026 self\n                .relations\n                .get(\u0026relation_key)\n                .unwrap()\n                .contains_key(relation)\n    }\n}\n","traces":[{"line":17,"address":[4345904],"length":1,"stats":{"Line":1},"fn_name":"node_count"},{"line":18,"address":[4345913],"length":1,"stats":{"Line":1},"fn_name":null},{"line":21,"address":[4345952],"length":1,"stats":{"Line":5},"fn_name":"get_node"},{"line":22,"address":[4345971],"length":1,"stats":{"Line":2},"fn_name":null},{"line":25,"address":[4346016,4346082],"length":1,"stats":{"Line":2},"fn_name":"create_node"},{"line":26,"address":[4346097,4346028],"length":1,"stats":{"Line":4},"fn_name":null},{"line":27,"address":[4346110],"length":1,"stats":{"Line":3},"fn_name":null},{"line":28,"address":[4346146,4346215],"length":1,"stats":{"Line":7},"fn_name":null},{"line":29,"address":[4346345],"length":1,"stats":{"Line":2},"fn_name":null},{"line":32,"address":[4346544],"length":1,"stats":{"Line":1},"fn_name":"find_by_attribute"},{"line":33,"address":[4346579,4346635],"length":1,"stats":{"Line":2},"fn_name":null},{"line":35,"address":[4233664],"length":1,"stats":{"Line":2},"fn_name":"{{closure}}"},{"line":36,"address":[4233678,4233716,4233740],"length":1,"stats":{"Line":3},"fn_name":null},{"line":37,"address":[4233696],"length":1,"stats":{"Line":1},"fn_name":null},{"line":38,"address":[4233630,4233726,4233616],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[4346704],"length":1,"stats":{"Line":1},"fn_name":"edge_count"},{"line":47,"address":[4346713],"length":1,"stats":{"Line":2},"fn_name":null},{"line":50,"address":[4346752],"length":1,"stats":{"Line":1},"fn_name":"get_edge"},{"line":51,"address":[4346771],"length":1,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[4346958,4346816],"length":1,"stats":{"Line":3},"fn_name":"create_edge"},{"line":62,"address":[4346928,4346973],"length":1,"stats":{"Line":6},"fn_name":null},{"line":63,"address":[4346981],"length":1,"stats":{"Line":3},"fn_name":null},{"line":64,"address":[4347014],"length":1,"stats":{"Line":3},"fn_name":null},{"line":65,"address":[4347045],"length":1,"stats":{"Line":3},"fn_name":null},{"line":67,"address":[4347200],"length":1,"stats":{"Line":3},"fn_name":null},{"line":68,"address":[4347244],"length":1,"stats":{"Line":4},"fn_name":null},{"line":70,"address":[4347401],"length":1,"stats":{"Line":3},"fn_name":null},{"line":72,"address":[4347463],"length":1,"stats":{"Line":4},"fn_name":null},{"line":73,"address":[4347504,4347561],"length":1,"stats":{"Line":6},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":75,"address":[4347513],"length":1,"stats":{"Line":4},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":78,"address":[4347604],"length":1,"stats":{"Line":4},"fn_name":null},{"line":80,"address":[4347736],"length":1,"stats":{"Line":3},"fn_name":null},{"line":83,"address":[4348115,4348048],"length":1,"stats":{"Line":1},"fn_name":"remove_edge"},{"line":84,"address":[4348130,4348073],"length":1,"stats":{"Line":2},"fn_name":null},{"line":85,"address":[4348159,4348236],"length":1,"stats":{"Line":3},"fn_name":null},{"line":86,"address":[4348305,4348377],"length":1,"stats":{"Line":4},"fn_name":null},{"line":87,"address":[4348385],"length":1,"stats":{"Line":2},"fn_name":null},{"line":88,"address":[4348458,4348537],"length":1,"stats":{"Line":3},"fn_name":null},{"line":89,"address":[4348487],"length":1,"stats":{"Line":1},"fn_name":null},{"line":93,"address":[4348685,4348624],"length":1,"stats":{"Line":1},"fn_name":"has_any_relation"},{"line":94,"address":[4348653],"length":1,"stats":{"Line":1},"fn_name":null},{"line":95,"address":[4348697,4348784,4348841],"length":1,"stats":{"Line":3},"fn_name":null},{"line":96,"address":[4348739,4348807],"length":1,"stats":{"Line":2},"fn_name":null},{"line":99,"address":[4348880,4348962],"length":1,"stats":{"Line":1},"fn_name":"has_relation"},{"line":100,"address":[4348930],"length":1,"stats":{"Line":1},"fn_name":null},{"line":101,"address":[4349126,4348974,4349061],"length":1,"stats":{"Line":3},"fn_name":null},{"line":102,"address":[4349111,4349084,4349016],"length":1,"stats":{"Line":3},"fn_name":null},{"line":103,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[4349096],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":48,"coverable":54},{"path":["/","home","floric","Dev","Github","rust-tests","graph-db","src","model","graph","util.rs"],"content":"pub fn build_relation_key(source_id: \u0026str, destination_id: \u0026str) -\u003e String {\n    format!(\"{}-{}\", source_id, destination_id)\n}\n\n#[cfg(test)]\nmod tests {\n    #[test]\n    fn test_create_key() {\n        let key = super::build_relation_key(\"a\", \"b\");\n        assert_eq!(\"a-b\", key);\n    }\n\n    #[test]\n    fn test_direction_of_key() {\n        assert_ne!(\n            super::build_relation_key(\"a\", \"b\"),\n            super::build_relation_key(\"b\", \"a\")\n        );\n    }\n}\n","traces":[{"line":1,"address":[4231744],"length":1,"stats":{"Line":3},"fn_name":"build_relation_key"},{"line":2,"address":[4231781],"length":1,"stats":{"Line":3},"fn_name":null},{"line":8,"address":[4227248,4227253],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":9,"address":[4336837],"length":1,"stats":{"Line":1},"fn_name":null},{"line":10,"address":[4336878,4336980],"length":1,"stats":{"Line":1},"fn_name":null},{"line":14,"address":[4227285,4227280],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":15,"address":[4337416],"length":1,"stats":{"Line":1},"fn_name":null},{"line":16,"address":[4337333],"length":1,"stats":{"Line":1},"fn_name":null},{"line":17,"address":[4337374],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":9,"coverable":9},{"path":["/","home","floric","Dev","Github","rust-tests","graph-db","src","model","node.rs"],"content":"use super::attributes::Attributes;\nuse nanoid::nanoid;\nuse std::hash::Hash;\n\n#[derive(Clone, Hash, PartialEq, Eq)]\npub struct Node {\n    id: String,\n    attributes: Attributes,\n}\n\nimpl Node {\n    pub fn new(attributes: Attributes) -\u003e Node {\n        Node {\n            id: nanoid!(),\n            attributes,\n        }\n    }\n\n    pub fn id(\u0026self) -\u003e \u0026String {\n        \u0026self.id\n    }\n\n    pub fn attributes(\u0026self) -\u003e \u0026Attributes {\n        \u0026self.attributes\n    }\n}\n","traces":[{"line":12,"address":[4229722,4229632],"length":1,"stats":{"Line":2},"fn_name":"new"},{"line":14,"address":[4229642],"length":1,"stats":{"Line":2},"fn_name":null},{"line":19,"address":[4526192],"length":1,"stats":{"Line":2},"fn_name":"id"},{"line":20,"address":[4229893],"length":1,"stats":{"Line":5},"fn_name":null},{"line":23,"address":[4229904],"length":1,"stats":{"Line":1},"fn_name":"attributes"},{"line":24,"address":[4229909],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":6,"coverable":6},{"path":["/","home","floric","Dev","Github","rust-tests","graph-db","tests","attributes.rs"],"content":"use neuland::model::Attributes;\n\n#[test]\nfn test_attributes_creation() {\n    let attributes = Attributes::default();\n\n    assert_eq!(0, attributes.value_count());\n}\n\n#[test]\nfn test_set_and_get_value() {\n    let mut attributes = Attributes::default();\n    attributes.set(\"a\", String::from(\"b\"));\n\n    assert_eq!(attributes.get(\"a\").unwrap(), \"b\");\n}\n\n#[test]\nfn test_unknown_value() {\n    let mut attributes = Attributes::default();\n    attributes.set(\"x\", String::from(\"y\"));\n\n    assert!(attributes.get(\"a\").is_none());\n}\n\n#[test]\nfn test_remove_value() {\n    let mut attributes = Attributes::default();\n    attributes.set(\"a\", String::from(\"b\"));\n    attributes.remove(\"a\");\n\n    assert!(attributes.get(\"a\").is_none());\n}\n","traces":[{"line":4,"address":[4212725,4212720],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":5,"address":[4213799],"length":1,"stats":{"Line":1},"fn_name":null},{"line":7,"address":[4213979,4213826],"length":1,"stats":{"Line":1},"fn_name":null},{"line":11,"address":[4212752,4212757],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":12,"address":[4214327],"length":1,"stats":{"Line":1},"fn_name":null},{"line":13,"address":[4214354],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[4214429,4214611],"length":1,"stats":{"Line":1},"fn_name":null},{"line":19,"address":[4212784,4212789],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":20,"address":[4214948],"length":1,"stats":{"Line":1},"fn_name":null},{"line":21,"address":[4214972],"length":1,"stats":{"Line":1},"fn_name":null},{"line":23,"address":[4215041,4215122],"length":1,"stats":{"Line":1},"fn_name":null},{"line":27,"address":[4212816,4212821],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":28,"address":[4215188],"length":1,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[4215212],"length":1,"stats":{"Line":1},"fn_name":null},{"line":30,"address":[4215281],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[4215390,4215309],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":16,"coverable":16},{"path":["/","home","floric","Dev","Github","rust-tests","graph-db","tests","find.rs"],"content":"use neuland::model::Attributes;\nuse neuland::model::Graph;\n\n#[test]\nfn test_node_find_by_attributes() {\n    let mut graph = Graph::default();\n    let mut attributes_a = Attributes::default();\n    attributes_a.set(\"test\", String::from(\"a\"));\n    let mut attributes_b = Attributes::default();\n    attributes_b.set(\"test\", String::from(\"b\"));\n    let node_a = graph.create_node(attributes_a).clone();\n    let node_b = graph.create_node(attributes_b).clone();\n    let node_c = graph.create_node(Attributes::default()).clone();\n\n    let matches = graph.find_by_attribute(\"test\", \"a\");\n    assert_eq!(1, matches.len());\n    assert!(matches.contains(\u0026\u0026node_a));\n    assert!(!matches.contains(\u0026\u0026node_b));\n    assert!(!matches.contains(\u0026\u0026node_c));\n}\n","traces":[{"line":5,"address":[4211829,4211824],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":6,"address":[4216023],"length":1,"stats":{"Line":1},"fn_name":null},{"line":7,"address":[4216077],"length":1,"stats":{"Line":1},"fn_name":null},{"line":8,"address":[4216084,4216134],"length":1,"stats":{"Line":2},"fn_name":null},{"line":9,"address":[4216181],"length":1,"stats":{"Line":1},"fn_name":null},{"line":10,"address":[4216188],"length":1,"stats":{"Line":1},"fn_name":null},{"line":11,"address":[4216262],"length":1,"stats":{"Line":1},"fn_name":null},{"line":12,"address":[4216392],"length":1,"stats":{"Line":1},"fn_name":null},{"line":13,"address":[4216548,4216621],"length":1,"stats":{"Line":2},"fn_name":null},{"line":15,"address":[4216628],"length":1,"stats":{"Line":1},"fn_name":null},{"line":16,"address":[4216680,4216734,4216882],"length":1,"stats":{"Line":2},"fn_name":null},{"line":17,"address":[4217200,4216862,4217272],"length":1,"stats":{"Line":2},"fn_name":null},{"line":18,"address":[4217387,4217255,4217313],"length":1,"stats":{"Line":2},"fn_name":null},{"line":19,"address":[4217370,4217492,4217428],"length":1,"stats":{"Line":2},"fn_name":null}],"covered":14,"coverable":14},{"path":["/","home","floric","Dev","Github","rust-tests","graph-db","tests","graph.rs"],"content":"use neuland::model::Attributes;\nuse neuland::model::Graph;\n\n#[test]\nfn test_graph_creation() {\n    let graph = Graph::default();\n\n    assert_eq!(0, graph.node_count());\n}\n\n#[test]\nfn test_node_creation() {\n    let mut graph = Graph::default();\n    let node_a = graph.create_node(Attributes::default()).clone();\n    let node_b = graph.create_node(Attributes::default()).clone();\n\n    assert_eq!(21, node_a.id().len());\n    assert_eq!(21, node_b.id().len());\n    assert_ne!(node_a.id(), node_b.id());\n    assert_eq!(2, graph.node_count());\n    assert!(!graph.has_any_relation(node_a.id(), node_b.id()));\n}\n\n#[test]\nfn test_edge_creation() {\n    let mut graph = Graph::default();\n\n    let node_a = graph.create_node(Attributes::default()).clone();\n    let node_b = graph.create_node(Attributes::default()).clone();\n    let edge_a = graph\n        .create_edge(\"rel-a\", Attributes::default(), node_a.id(), node_b.id())\n        .clone();\n    graph.create_edge(\"rel-b\", Attributes::default(), node_a.id(), node_b.id());\n\n    assert!(graph.has_any_relation(node_a.id(), node_b.id()));\n    assert!(!graph.has_any_relation(node_b.id(), node_a.id()));\n    assert!(!graph.has_any_relation(node_a.id(), node_a.id()));\n    assert!(graph.has_relation(\"rel-a\", node_a.id(), node_b.id()));\n    assert!(graph.has_relation(\"rel-b\", node_a.id(), node_b.id()));\n    assert!(!graph.has_relation(\"rel-c\", node_a.id(), node_b.id()));\n    assert_eq!(21, edge_a.id().len());\n    assert_eq!(node_a.id(), edge_a.from_id());\n    assert_eq!(node_b.id(), edge_a.to_id());\n    assert_eq!(2, graph.node_count());\n    assert_eq!(2, graph.edge_count());\n}\n\n#[test]\nfn test_edge_retrieval() {\n    let mut graph = Graph::default();\n\n    let node_a = graph.create_node(Attributes::default()).clone();\n    let node_b = graph.create_node(Attributes::default()).clone();\n    let edge_a = graph\n        .create_edge(\"rel-a\", Attributes::default(), node_a.id(), node_b.id())\n        .clone();\n    let saved_edge_a = graph.get_edge(edge_a.id()).unwrap();\n\n    assert_eq!(saved_edge_a.id(), edge_a.id());\n    assert!(graph.get_edge(\"abc\").is_none());\n}\n\n#[test]\nfn test_edge_removal() {\n    let mut graph = Graph::default();\n\n    let node_a = graph.create_node(Attributes::default()).clone();\n    let node_b = graph.create_node(Attributes::default()).clone();\n    let edge = graph\n        .create_edge(\"rel-a\", Attributes::default(), node_a.id(), node_b.id())\n        .clone();\n    graph.create_edge(\"rel-b\", Attributes::default(), node_a.id(), node_b.id());\n    graph.remove_edge(edge.id());\n\n    assert!(!graph.has_relation(\"rel-a\", node_a.id(), node_b.id()));\n    assert!(graph.has_relation(\"rel-b\", node_a.id(), node_b.id()));\n    assert_eq!(2, graph.node_count());\n    assert_eq!(1, graph.edge_count());\n    assert!(graph.has_any_relation(node_a.id(), node_b.id()));\n}\n\n#[test]\nfn test_edges_removal() {\n    let mut graph = Graph::default();\n\n    let node_a = graph.create_node(Attributes::default()).clone();\n    let node_b = graph.create_node(Attributes::default()).clone();\n    let edge_a = graph\n        .create_edge(\"rel-a\", Attributes::default(), node_a.id(), node_b.id())\n        .clone();\n    let edge_b = graph\n        .create_edge(\"rel-b\", Attributes::default(), node_a.id(), node_b.id())\n        .clone();\n    graph.remove_edge(edge_a.id());\n    graph.remove_edge(edge_b.id());\n\n    assert!(!graph.has_relation(\"rel-a\", node_a.id(), node_b.id()));\n    assert!(!graph.has_relation(\"rel-b\", node_a.id(), node_b.id()));\n    assert_eq!(2, graph.node_count());\n    assert_eq!(0, graph.edge_count());\n    assert!(!graph.has_any_relation(node_a.id(), node_b.id()));\n}\n","traces":[{"line":5,"address":[4214400,4214405],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":6,"address":[4214791],"length":1,"stats":{"Line":1},"fn_name":null},{"line":8,"address":[4214818,4214983],"length":1,"stats":{"Line":1},"fn_name":null},{"line":12,"address":[4214437,4214432],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":13,"address":[4215335],"length":1,"stats":{"Line":1},"fn_name":null},{"line":14,"address":[4215446,4215373],"length":1,"stats":{"Line":2},"fn_name":null},{"line":15,"address":[4215461,4215534],"length":1,"stats":{"Line":2},"fn_name":null},{"line":17,"address":[4215751,4215621,4215541],"length":1,"stats":{"Line":2},"fn_name":null},{"line":18,"address":[4216265,4216105,4215721],"length":1,"stats":{"Line":2},"fn_name":null},{"line":19,"address":[4216619,4216807,4216235],"length":1,"stats":{"Line":2},"fn_name":null},{"line":20,"address":[4217154,4217281,4216777],"length":1,"stats":{"Line":2},"fn_name":null},{"line":21,"address":[4217254,4217596,4217749],"length":1,"stats":{"Line":2},"fn_name":null},{"line":25,"address":[4214464,4214469],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":26,"address":[4217895],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[4217949,4218022],"length":1,"stats":{"Line":2},"fn_name":null},{"line":29,"address":[4218037,4218110],"length":1,"stats":{"Line":2},"fn_name":null},{"line":30,"address":[4218303,4218424],"length":1,"stats":{"Line":2},"fn_name":null},{"line":31,"address":[4218190,4218400,4222835,4218125],"length":1,"stats":{"Line":3},"fn_name":null},{"line":33,"address":[4218507,4222876,4218439],"length":1,"stats":{"Line":2},"fn_name":null},{"line":35,"address":[4218963,4218717],"length":1,"stats":{"Line":1},"fn_name":null},{"line":36,"address":[4219217,4218936,4219004],"length":1,"stats":{"Line":2},"fn_name":null},{"line":37,"address":[4219471,4219258,4219190],"length":1,"stats":{"Line":2},"fn_name":null},{"line":38,"address":[4219512,4219444,4219741],"length":1,"stats":{"Line":2},"fn_name":null},{"line":39,"address":[4219782,4220011,4219714],"length":1,"stats":{"Line":2},"fn_name":null},{"line":40,"address":[4220052,4220283,4219984],"length":1,"stats":{"Line":2},"fn_name":null},{"line":41,"address":[4220484,4220256,4220324],"length":1,"stats":{"Line":2},"fn_name":null},{"line":42,"address":[4220454,4221026,4220838],"length":1,"stats":{"Line":2},"fn_name":null},{"line":43,"address":[4220996,4221372,4221560],"length":1,"stats":{"Line":2},"fn_name":null},{"line":44,"address":[4221530,4222034,4221907],"length":1,"stats":{"Line":2},"fn_name":null},{"line":45,"address":[4222474,4222356,4222007],"length":1,"stats":{"Line":2},"fn_name":null},{"line":49,"address":[4214501,4214496],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":50,"address":[4223047],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[4223093,4223166],"length":1,"stats":{"Line":2},"fn_name":null},{"line":53,"address":[4223254,4223181],"length":1,"stats":{"Line":2},"fn_name":null},{"line":54,"address":[4223447,4223568],"length":1,"stats":{"Line":2},"fn_name":null},{"line":55,"address":[4223334,4223544,4224376,4223269],"length":1,"stats":{"Line":3},"fn_name":null},{"line":57,"address":[4223648,4223575],"length":1,"stats":{"Line":2},"fn_name":null},{"line":59,"address":[4223719,4223933],"length":1,"stats":{"Line":1},"fn_name":null},{"line":60,"address":[4223894,4224240,4224292],"length":1,"stats":{"Line":2},"fn_name":null},{"line":64,"address":[4214533,4214528],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":65,"address":[4224535],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[4224589,4224662],"length":1,"stats":{"Line":2},"fn_name":null},{"line":68,"address":[4224677,4224750],"length":1,"stats":{"Line":2},"fn_name":null},{"line":69,"address":[4224943,4225064],"length":1,"stats":{"Line":2},"fn_name":null},{"line":70,"address":[4224830,4227214,4224765,4225040],"length":1,"stats":{"Line":3},"fn_name":null},{"line":72,"address":[4225079,4225147,4227255],"length":1,"stats":{"Line":2},"fn_name":null},{"line":73,"address":[4225357],"length":1,"stats":{"Line":1},"fn_name":null},{"line":75,"address":[4225450,4225716],"length":1,"stats":{"Line":1},"fn_name":null},{"line":76,"address":[4225986,4225689,4225757],"length":1,"stats":{"Line":2},"fn_name":null},{"line":77,"address":[4226164,4225959,4226034],"length":1,"stats":{"Line":2},"fn_name":null},{"line":78,"address":[4226525,4226655,4226134],"length":1,"stats":{"Line":2},"fn_name":null},{"line":79,"address":[4226979,4227130,4226625],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[4214560,4214565],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":84,"address":[4227431],"length":1,"stats":{"Line":1},"fn_name":null},{"line":86,"address":[4227485,4227558],"length":1,"stats":{"Line":2},"fn_name":null},{"line":87,"address":[4227573,4227646],"length":1,"stats":{"Line":2},"fn_name":null},{"line":88,"address":[4227960,4227839],"length":1,"stats":{"Line":2},"fn_name":null},{"line":89,"address":[4227936,4230265,4227661,4227726],"length":1,"stats":{"Line":3},"fn_name":null},{"line":91,"address":[4228277,4228156],"length":1,"stats":{"Line":2},"fn_name":null},{"line":92,"address":[4227975,4230306,4228043,4228253],"length":1,"stats":{"Line":3},"fn_name":null},{"line":94,"address":[4228360,4228284],"length":1,"stats":{"Line":2},"fn_name":null},{"line":95,"address":[4228395],"length":1,"stats":{"Line":1},"fn_name":null},{"line":97,"address":[4228754,4228488],"length":1,"stats":{"Line":1},"fn_name":null},{"line":98,"address":[4228727,4229026,4228795],"length":1,"stats":{"Line":2},"fn_name":null},{"line":99,"address":[4229204,4229074,4228999],"length":1,"stats":{"Line":2},"fn_name":null},{"line":100,"address":[4229174,4229695,4229565],"length":1,"stats":{"Line":2},"fn_name":null},{"line":101,"address":[4229665,4230013,4230166],"length":1,"stats":{"Line":2},"fn_name":null}],"covered":67,"coverable":67}]};
        var previousData = {"files":[{"path":["/","home","floric","Dev","Github","rust-tests","graph-db","src","model","attributes.rs"],"content":"use std::collections::HashMap;\nuse std::hash::{Hash, Hasher};\n\n#[derive(Default, Clone, Eq)]\npub struct Attributes {\n    values: HashMap\u003cString, String\u003e,\n}\n\nimpl Attributes {\n    pub fn value_count(\u0026self) -\u003e usize {\n        self.values.len()\n    }\n\n    pub fn get(\u0026self, key: \u0026str) -\u003e Option\u003c\u0026String\u003e {\n        self.values.get(key)\n    }\n\n    pub fn set(\u0026mut self, key: \u0026str, value: String) {\n        self.values.insert(key.to_string(), value);\n    }\n\n    pub fn remove(\u0026mut self, key: \u0026str) {\n        self.values.remove(key);\n    }\n}\n\nimpl Hash for Attributes {\n    fn hash\u003cH: Hasher\u003e(\u0026self, hasher: \u0026mut H) {\n        for att in self.values.iter() {\n            att.hash(hasher);\n        }\n    }\n}\n\nimpl PartialEq for Attributes {\n    fn eq(\u0026self, other: \u0026Self) -\u003e bool {\n        other.values.eq(\u0026self.values)\n    }\n}\n","traces":[{"line":10,"address":[4541808],"length":1,"stats":{"Line":1},"fn_name":"value_count"},{"line":11,"address":[4543129],"length":1,"stats":{"Line":1},"fn_name":null},{"line":14,"address":[4369056],"length":1,"stats":{"Line":3},"fn_name":"get"},{"line":15,"address":[4543187],"length":1,"stats":{"Line":3},"fn_name":null},{"line":18,"address":[4522336,4522414],"length":1,"stats":{"Line":3},"fn_name":"set"},{"line":19,"address":[4522358,4522429],"length":1,"stats":{"Line":6},"fn_name":null},{"line":22,"address":[4522608],"length":1,"stats":{"Line":1},"fn_name":"remove"},{"line":23,"address":[4543523],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":30,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":36,"address":[4522672],"length":1,"stats":{"Line":1},"fn_name":"eq"},{"line":37,"address":[4522686],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":10,"coverable":13},{"path":["/","home","floric","Dev","Github","rust-tests","graph-db","src","model","edge.rs"],"content":"use super::attributes::Attributes;\nuse nanoid::nanoid;\nuse std::hash::Hash;\n\n#[derive(Clone, Hash, PartialEq, Eq)]\npub struct Edge {\n    id: String,\n    relation: String,\n    from: String,\n    to: String,\n    attributes: Attributes,\n}\n\nimpl Edge {\n    pub fn new(relation: String, from: String, to: String, attributes: Attributes) -\u003e Edge {\n        Edge {\n            id: nanoid!(),\n            relation,\n            from,\n            to,\n            attributes,\n        }\n    }\n\n    pub fn id(\u0026self) -\u003e \u0026String {\n        \u0026self.id\n    }\n\n    pub fn relation(\u0026self) -\u003e \u0026String {\n        \u0026self.relation\n    }\n\n    pub fn from_id(\u0026self) -\u003e \u0026String {\n        \u0026self.from\n    }\n\n    pub fn to_id(\u0026self) -\u003e \u0026String {\n        \u0026self.to\n    }\n\n    pub fn attributes(\u0026self) -\u003e \u0026Attributes {\n        \u0026self.attributes\n    }\n}\n","traces":[{"line":15,"address":[4557543,4557440],"length":1,"stats":{"Line":1},"fn_name":"new"},{"line":17,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":25,"address":[4338400],"length":1,"stats":{"Line":2},"fn_name":"id"},{"line":26,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[4338416],"length":1,"stats":{"Line":1},"fn_name":"relation"},{"line":30,"address":[4557989],"length":1,"stats":{"Line":1},"fn_name":null},{"line":33,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":34,"address":[4558021],"length":1,"stats":{"Line":1},"fn_name":null},{"line":37,"address":[4338480],"length":1,"stats":{"Line":1},"fn_name":"to_id"},{"line":38,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":41,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":42,"address":[],"length":0,"stats":{"Line":0},"fn_name":null}],"covered":10,"coverable":12},{"path":["/","home","floric","Dev","Github","rust-tests","graph-db","src","model","graph","mod.rs"],"content":"mod util;\n\nuse super::Attributes;\nuse super::Edge;\nuse super::Node;\nuse std::collections::HashMap;\nuse std::option::Option;\n\n#[derive(Default)]\npub struct Graph {\n    nodes: HashMap\u003cString, Node\u003e,\n    edges: HashMap\u003cString, Edge\u003e,\n    relations: HashMap\u003cString, HashMap\u003cString, String\u003e\u003e,\n}\n\nimpl Graph {\n    pub fn node_count(\u0026self) -\u003e usize {\n        self.nodes.len()\n    }\n\n    pub fn get_node(\u0026self, id: \u0026str) -\u003e Option\u003c\u0026Node\u003e {\n        self.nodes.get(id)\n    }\n\n    pub fn create_node(\u0026mut self, attributes: Attributes) -\u003e \u0026Node {\n        let n = Node::new(attributes);\n        let node_id = n.id().clone();\n        self.nodes.insert(n.id().clone(), n);\n        self.get_node(\u0026node_id).unwrap()\n    }\n\n    pub fn find_by_attribute(\u0026self, key: \u0026str, value: \u0026str) -\u003e Vec\u003c\u0026Node\u003e {\n        self.nodes\n            .values()\n            .filter(|node| -\u003e bool {\n                node.attributes()\n                    .get(key)\n                    .filter(|entry| -\u003e bool { *entry == value })\n                    .is_some()\n            })\n            .collect::\u003cVec\u003c\u0026Node\u003e\u003e()\n    }\n}\n\nimpl Graph {\n    pub fn edge_count(\u0026self) -\u003e usize {\n        self.edges.len()\n    }\n\n    pub fn get_edge(\u0026self, id: \u0026str) -\u003e Option\u003c\u0026Edge\u003e {\n        self.edges.get(id)\n    }\n\n    pub fn create_edge(\n        \u0026mut self,\n        relation: \u0026str,\n        attributes: Attributes,\n        source_id: \u0026str,\n        destination_id: \u0026str,\n    ) -\u003e \u0026Edge {\n        let e = Edge::new(\n            String::from(relation),\n            String::from(source_id),\n            String::from(destination_id),\n            attributes,\n        );\n        let edge_id = e.id().clone();\n        self.edges.insert(e.id().clone(), e);\n\n        let edge = self.edges.get(\u0026edge_id).unwrap();\n\n        let connection_key = util::build_relation_key(source_id, destination_id);\n        let relations_map = self\n            .relations\n            .entry(connection_key)\n            .or_insert_with(HashMap::new);\n\n        relations_map.insert(String::from(relation), edge_id);\n\n        edge\n    }\n\n    pub fn remove_edge(\u0026mut self, edge_id: \u0026str) {\n        let removed_edge = self.edges.remove(edge_id).unwrap();\n        let relation_key = util::build_relation_key(removed_edge.from_id(), removed_edge.to_id());\n        let relations = self.relations.get_mut(\u0026relation_key).unwrap();\n        relations.remove(removed_edge.relation());\n        if relations.is_empty() {\n            self.relations.remove(\u0026relation_key);\n        }\n    }\n\n    pub fn has_any_relation(\u0026self, source_id: \u0026str, destination_id: \u0026str) -\u003e bool {\n        let relation_key = util::build_relation_key(source_id, destination_id);\n        self.relations.contains_key(\u0026relation_key)\n            \u0026\u0026 !self.relations.get(\u0026relation_key).unwrap().is_empty()\n    }\n\n    pub fn has_relation(\u0026self, relation: \u0026str, source_id: \u0026str, destination_id: \u0026str) -\u003e bool {\n        let relation_key = util::build_relation_key(source_id, destination_id);\n        self.relations.contains_key(\u0026relation_key)\n            \u0026\u0026 self\n                .relations\n                .get(\u0026relation_key)\n                .unwrap()\n                .contains_key(relation)\n    }\n}\n","traces":[{"line":17,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":18,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":21,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":22,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":25,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":26,"address":[],"length":0,"stats":{"Line":5},"fn_name":null},{"line":27,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":28,"address":[],"length":0,"stats":{"Line":7},"fn_name":null},{"line":29,"address":[],"length":0,"stats":{"Line":4},"fn_name":null},{"line":32,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":33,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":35,"address":[4522096],"length":1,"stats":{"Line":2},"fn_name":"{{closure}}"},{"line":36,"address":[4522110,4522174,4522149],"length":1,"stats":{"Line":3},"fn_name":null},{"line":37,"address":[4522129],"length":1,"stats":{"Line":1},"fn_name":null},{"line":38,"address":[4522160,4522062,4522048],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":39,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":46,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":47,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":50,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":51,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":54,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":62,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":63,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":64,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":65,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":67,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":68,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":70,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":72,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":73,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":74,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":75,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":76,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":78,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":80,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":83,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":84,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":85,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":86,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":87,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":88,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":89,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":93,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":94,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":95,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":96,"address":[],"length":0,"stats":{"Line":2},"fn_name":null},{"line":99,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":100,"address":[],"length":0,"stats":{"Line":1},"fn_name":null},{"line":101,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":102,"address":[],"length":0,"stats":{"Line":3},"fn_name":null},{"line":103,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":104,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":105,"address":[],"length":0,"stats":{"Line":0},"fn_name":null},{"line":106,"address":[],"length":0,"stats":{"Line":1},"fn_name":null}],"covered":48,"coverable":54},{"path":["/","home","floric","Dev","Github","rust-tests","graph-db","src","model","graph","util.rs"],"content":"pub fn build_relation_key(source_id: \u0026str, destination_id: \u0026str) -\u003e String {\n    format!(\"{}-{}\", source_id, destination_id)\n}\n\n#[cfg(test)]\nmod tests {\n    #[test]\n    fn test_create_key() {\n        let key = super::build_relation_key(\"a\", \"b\");\n        assert_eq!(\"a-b\", key);\n    }\n\n    #[test]\n    fn test_direction_of_key() {\n        assert_ne!(\n            super::build_relation_key(\"a\", \"b\"),\n            super::build_relation_key(\"b\", \"a\")\n        );\n    }\n}\n","traces":[{"line":1,"address":[4560288],"length":1,"stats":{"Line":3},"fn_name":"build_relation_key"},{"line":2,"address":[4560325],"length":1,"stats":{"Line":3},"fn_name":null},{"line":8,"address":[4227253,4227248],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":9,"address":[4336837],"length":1,"stats":{"Line":1},"fn_name":null},{"line":10,"address":[4336980,4336878],"length":1,"stats":{"Line":1},"fn_name":null},{"line":14,"address":[4227280,4227285],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":15,"address":[4337416],"length":1,"stats":{"Line":1},"fn_name":null},{"line":16,"address":[4337333],"length":1,"stats":{"Line":1},"fn_name":null},{"line":17,"address":[4337374],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":9,"coverable":9},{"path":["/","home","floric","Dev","Github","rust-tests","graph-db","src","model","node.rs"],"content":"use super::attributes::Attributes;\nuse nanoid::nanoid;\nuse std::hash::Hash;\n\n#[derive(Clone, Hash, PartialEq, Eq)]\npub struct Node {\n    id: String,\n    attributes: Attributes,\n}\n\nimpl Node {\n    pub fn new(attributes: Attributes) -\u003e Node {\n        Node {\n            id: nanoid!(),\n            attributes,\n        }\n    }\n\n    pub fn id(\u0026self) -\u003e \u0026String {\n        \u0026self.id\n    }\n\n    pub fn attributes(\u0026self) -\u003e \u0026Attributes {\n        \u0026self.attributes\n    }\n}\n","traces":[{"line":12,"address":[4623120,4623210],"length":1,"stats":{"Line":2},"fn_name":"new"},{"line":14,"address":[4623130],"length":1,"stats":{"Line":2},"fn_name":null},{"line":19,"address":[4229888],"length":1,"stats":{"Line":3},"fn_name":"id"},{"line":20,"address":[4623381],"length":1,"stats":{"Line":4},"fn_name":null},{"line":23,"address":[4623392],"length":1,"stats":{"Line":1},"fn_name":"attributes"},{"line":24,"address":[4623397],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":6,"coverable":6},{"path":["/","home","floric","Dev","Github","rust-tests","graph-db","tests","attributes.rs"],"content":"use neuland::model::Attributes;\n\n#[test]\nfn test_attributes_creation() {\n    let attributes = Attributes::default();\n\n    assert_eq!(0, attributes.value_count());\n}\n\n#[test]\nfn test_set_and_get_value() {\n    let mut attributes = Attributes::default();\n    attributes.set(\"a\", String::from(\"b\"));\n\n    assert_eq!(attributes.get(\"a\").unwrap(), \"b\");\n}\n\n#[test]\nfn test_unknown_value() {\n    let mut attributes = Attributes::default();\n    attributes.set(\"x\", String::from(\"y\"));\n\n    assert!(attributes.get(\"a\").is_none());\n}\n\n#[test]\nfn test_remove_value() {\n    let mut attributes = Attributes::default();\n    attributes.set(\"a\", String::from(\"b\"));\n    attributes.remove(\"a\");\n\n    assert!(attributes.get(\"a\").is_none());\n}\n","traces":[{"line":4,"address":[4212725,4212720],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":5,"address":[4213799],"length":1,"stats":{"Line":1},"fn_name":null},{"line":7,"address":[4213979,4213826],"length":1,"stats":{"Line":1},"fn_name":null},{"line":11,"address":[4212757,4212752],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":12,"address":[4214327],"length":1,"stats":{"Line":1},"fn_name":null},{"line":13,"address":[4214354],"length":1,"stats":{"Line":1},"fn_name":null},{"line":15,"address":[4214429,4214611],"length":1,"stats":{"Line":1},"fn_name":null},{"line":19,"address":[4212789,4212784],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":20,"address":[4214948],"length":1,"stats":{"Line":1},"fn_name":null},{"line":21,"address":[4214972],"length":1,"stats":{"Line":1},"fn_name":null},{"line":23,"address":[4215122,4215041],"length":1,"stats":{"Line":1},"fn_name":null},{"line":27,"address":[4212821,4212816],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":28,"address":[4215188],"length":1,"stats":{"Line":1},"fn_name":null},{"line":29,"address":[4215212],"length":1,"stats":{"Line":1},"fn_name":null},{"line":30,"address":[4215281],"length":1,"stats":{"Line":1},"fn_name":null},{"line":32,"address":[4215309,4215390],"length":1,"stats":{"Line":1},"fn_name":null}],"covered":16,"coverable":16},{"path":["/","home","floric","Dev","Github","rust-tests","graph-db","tests","find.rs"],"content":"use neuland::model::Attributes;\nuse neuland::model::Graph;\n\n#[test]\nfn test_node_find_by_attributes() {\n    let mut graph = Graph::default();\n    let mut attributes_a = Attributes::default();\n    attributes_a.set(\"test\", String::from(\"a\"));\n    let mut attributes_b = Attributes::default();\n    attributes_b.set(\"test\", String::from(\"b\"));\n    let node_a = graph.create_node(attributes_a).clone();\n    let node_b = graph.create_node(attributes_b).clone();\n    let node_c = graph.create_node(Attributes::default()).clone();\n\n    let matches = graph.find_by_attribute(\"test\", \"a\");\n    assert_eq!(1, matches.len());\n    assert!(matches.contains(\u0026\u0026node_a));\n    assert!(!matches.contains(\u0026\u0026node_b));\n    assert!(!matches.contains(\u0026\u0026node_c));\n}\n","traces":[{"line":5,"address":[4211824,4211829],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":6,"address":[4216023],"length":1,"stats":{"Line":1},"fn_name":null},{"line":7,"address":[4216077],"length":1,"stats":{"Line":1},"fn_name":null},{"line":8,"address":[4216084,4216134],"length":1,"stats":{"Line":2},"fn_name":null},{"line":9,"address":[4216181],"length":1,"stats":{"Line":1},"fn_name":null},{"line":10,"address":[4216188],"length":1,"stats":{"Line":1},"fn_name":null},{"line":11,"address":[4216262],"length":1,"stats":{"Line":1},"fn_name":null},{"line":12,"address":[4216392],"length":1,"stats":{"Line":1},"fn_name":null},{"line":13,"address":[4216548,4216621],"length":1,"stats":{"Line":2},"fn_name":null},{"line":15,"address":[4216628],"length":1,"stats":{"Line":1},"fn_name":null},{"line":16,"address":[4216882,4216734,4216680],"length":1,"stats":{"Line":2},"fn_name":null},{"line":17,"address":[4217272,4217200,4216862],"length":1,"stats":{"Line":2},"fn_name":null},{"line":18,"address":[4217313,4217387,4217255],"length":1,"stats":{"Line":2},"fn_name":null},{"line":19,"address":[4217492,4217370,4217428],"length":1,"stats":{"Line":2},"fn_name":null}],"covered":14,"coverable":14},{"path":["/","home","floric","Dev","Github","rust-tests","graph-db","tests","graph.rs"],"content":"use neuland::model::Attributes;\nuse neuland::model::Graph;\n\n#[test]\nfn test_graph_creation() {\n    let graph = Graph::default();\n\n    assert_eq!(0, graph.node_count());\n}\n\n#[test]\nfn test_node_creation() {\n    let mut graph = Graph::default();\n    let node_a = graph.create_node(Attributes::default()).clone();\n    let node_b = graph.create_node(Attributes::default()).clone();\n\n    assert_eq!(21, node_a.id().len());\n    assert_eq!(21, node_b.id().len());\n    assert_ne!(node_a.id(), node_b.id());\n    assert_eq!(2, graph.node_count());\n    assert!(!graph.has_any_relation(node_a.id(), node_b.id()));\n}\n\n#[test]\nfn test_edge_creation() {\n    let mut graph = Graph::default();\n\n    let node_a = graph.create_node(Attributes::default()).clone();\n    let node_b = graph.create_node(Attributes::default()).clone();\n    let edge_a = graph\n        .create_edge(\"rel-a\", Attributes::default(), node_a.id(), node_b.id())\n        .clone();\n    graph.create_edge(\"rel-b\", Attributes::default(), node_a.id(), node_b.id());\n\n    assert!(graph.has_any_relation(node_a.id(), node_b.id()));\n    assert!(!graph.has_any_relation(node_b.id(), node_a.id()));\n    assert!(!graph.has_any_relation(node_a.id(), node_a.id()));\n    assert!(graph.has_relation(\"rel-a\", node_a.id(), node_b.id()));\n    assert!(graph.has_relation(\"rel-b\", node_a.id(), node_b.id()));\n    assert!(!graph.has_relation(\"rel-c\", node_a.id(), node_b.id()));\n    assert_eq!(21, edge_a.id().len());\n    assert_eq!(node_a.id(), edge_a.from_id());\n    assert_eq!(node_b.id(), edge_a.to_id());\n    assert_eq!(2, graph.node_count());\n    assert_eq!(2, graph.edge_count());\n}\n\n#[test]\nfn test_edge_retrieval() {\n    let mut graph = Graph::default();\n\n    let node_a = graph.create_node(Attributes::default()).clone();\n    let node_b = graph.create_node(Attributes::default()).clone();\n    let edge_a = graph\n        .create_edge(\"rel-a\", Attributes::default(), node_a.id(), node_b.id())\n        .clone();\n    let saved_edge_a = graph.get_edge(edge_a.id()).unwrap();\n\n    assert_eq!(saved_edge_a.id(), edge_a.id());\n    assert!(graph.get_edge(\"abc\").is_none());\n}\n\n#[test]\nfn test_edge_removal() {\n    let mut graph = Graph::default();\n\n    let node_a = graph.create_node(Attributes::default()).clone();\n    let node_b = graph.create_node(Attributes::default()).clone();\n    let edge = graph\n        .create_edge(\"rel-a\", Attributes::default(), node_a.id(), node_b.id())\n        .clone();\n    graph.create_edge(\"rel-b\", Attributes::default(), node_a.id(), node_b.id());\n    graph.remove_edge(edge.id());\n\n    assert!(!graph.has_relation(\"rel-a\", node_a.id(), node_b.id()));\n    assert!(graph.has_relation(\"rel-b\", node_a.id(), node_b.id()));\n    assert_eq!(2, graph.node_count());\n    assert_eq!(1, graph.edge_count());\n    assert!(graph.has_any_relation(node_a.id(), node_b.id()));\n}\n\n#[test]\nfn test_edges_removal() {\n    let mut graph = Graph::default();\n\n    let node_a = graph.create_node(Attributes::default()).clone();\n    let node_b = graph.create_node(Attributes::default()).clone();\n    let edge_a = graph\n        .create_edge(\"rel-a\", Attributes::default(), node_a.id(), node_b.id())\n        .clone();\n    let edge_b = graph\n        .create_edge(\"rel-b\", Attributes::default(), node_a.id(), node_b.id())\n        .clone();\n    graph.remove_edge(edge_a.id());\n    graph.remove_edge(edge_b.id());\n\n    assert!(!graph.has_relation(\"rel-a\", node_a.id(), node_b.id()));\n    assert!(!graph.has_relation(\"rel-b\", node_a.id(), node_b.id()));\n    assert_eq!(2, graph.node_count());\n    assert_eq!(0, graph.edge_count());\n    assert!(!graph.has_any_relation(node_a.id(), node_b.id()));\n}\n","traces":[{"line":5,"address":[4214405,4214400],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":6,"address":[4214791],"length":1,"stats":{"Line":1},"fn_name":null},{"line":8,"address":[4214983,4214818],"length":1,"stats":{"Line":1},"fn_name":null},{"line":12,"address":[4214432,4214437],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":13,"address":[4215335],"length":1,"stats":{"Line":1},"fn_name":null},{"line":14,"address":[4215373,4215446],"length":1,"stats":{"Line":2},"fn_name":null},{"line":15,"address":[4215461,4215534],"length":1,"stats":{"Line":2},"fn_name":null},{"line":17,"address":[4215621,4215751,4215541],"length":1,"stats":{"Line":2},"fn_name":null},{"line":18,"address":[4216105,4216265,4215721],"length":1,"stats":{"Line":2},"fn_name":null},{"line":19,"address":[4216235,4216807,4216619],"length":1,"stats":{"Line":2},"fn_name":null},{"line":20,"address":[4216777,4217154,4217281],"length":1,"stats":{"Line":2},"fn_name":null},{"line":21,"address":[4217749,4217596,4217254],"length":1,"stats":{"Line":2},"fn_name":null},{"line":25,"address":[4214469,4214464],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":26,"address":[4217895],"length":1,"stats":{"Line":1},"fn_name":null},{"line":28,"address":[4218022,4217949],"length":1,"stats":{"Line":2},"fn_name":null},{"line":29,"address":[4218110,4218037],"length":1,"stats":{"Line":2},"fn_name":null},{"line":30,"address":[4218424,4218303],"length":1,"stats":{"Line":2},"fn_name":null},{"line":31,"address":[4222835,4218400,4218125,4218190],"length":1,"stats":{"Line":3},"fn_name":null},{"line":33,"address":[4218439,4218507,4222876],"length":1,"stats":{"Line":2},"fn_name":null},{"line":35,"address":[4218963,4218717],"length":1,"stats":{"Line":1},"fn_name":null},{"line":36,"address":[4218936,4219004,4219217],"length":1,"stats":{"Line":2},"fn_name":null},{"line":37,"address":[4219258,4219190,4219471],"length":1,"stats":{"Line":2},"fn_name":null},{"line":38,"address":[4219444,4219512,4219741],"length":1,"stats":{"Line":2},"fn_name":null},{"line":39,"address":[4220011,4219714,4219782],"length":1,"stats":{"Line":2},"fn_name":null},{"line":40,"address":[4219984,4220283,4220052],"length":1,"stats":{"Line":2},"fn_name":null},{"line":41,"address":[4220256,4220324,4220484],"length":1,"stats":{"Line":2},"fn_name":null},{"line":42,"address":[4221026,4220838,4220454],"length":1,"stats":{"Line":2},"fn_name":null},{"line":43,"address":[4220996,4221372,4221560],"length":1,"stats":{"Line":2},"fn_name":null},{"line":44,"address":[4221907,4221530,4222034],"length":1,"stats":{"Line":2},"fn_name":null},{"line":45,"address":[4222356,4222474,4222007],"length":1,"stats":{"Line":2},"fn_name":null},{"line":49,"address":[4214501,4214496],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":50,"address":[4223047],"length":1,"stats":{"Line":1},"fn_name":null},{"line":52,"address":[4223093,4223166],"length":1,"stats":{"Line":2},"fn_name":null},{"line":53,"address":[4223254,4223181],"length":1,"stats":{"Line":2},"fn_name":null},{"line":54,"address":[4223447,4223568],"length":1,"stats":{"Line":2},"fn_name":null},{"line":55,"address":[4223269,4223334,4224376,4223544],"length":1,"stats":{"Line":3},"fn_name":null},{"line":57,"address":[4223575,4223648],"length":1,"stats":{"Line":2},"fn_name":null},{"line":59,"address":[4223719,4223933],"length":1,"stats":{"Line":1},"fn_name":null},{"line":60,"address":[4223894,4224240,4224292],"length":1,"stats":{"Line":2},"fn_name":null},{"line":64,"address":[4214533,4214528],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":65,"address":[4224535],"length":1,"stats":{"Line":1},"fn_name":null},{"line":67,"address":[4224589,4224662],"length":1,"stats":{"Line":2},"fn_name":null},{"line":68,"address":[4224750,4224677],"length":1,"stats":{"Line":2},"fn_name":null},{"line":69,"address":[4224943,4225064],"length":1,"stats":{"Line":2},"fn_name":null},{"line":70,"address":[4224765,4227214,4225040,4224830],"length":1,"stats":{"Line":3},"fn_name":null},{"line":72,"address":[4225079,4227255,4225147],"length":1,"stats":{"Line":2},"fn_name":null},{"line":73,"address":[4225357],"length":1,"stats":{"Line":1},"fn_name":null},{"line":75,"address":[4225716,4225450],"length":1,"stats":{"Line":1},"fn_name":null},{"line":76,"address":[4225757,4225986,4225689],"length":1,"stats":{"Line":2},"fn_name":null},{"line":77,"address":[4225959,4226034,4226164],"length":1,"stats":{"Line":2},"fn_name":null},{"line":78,"address":[4226134,4226655,4226525],"length":1,"stats":{"Line":2},"fn_name":null},{"line":79,"address":[4226625,4227130,4226979],"length":1,"stats":{"Line":2},"fn_name":null},{"line":83,"address":[4214565,4214560],"length":1,"stats":{"Line":3},"fn_name":"{{closure}}"},{"line":84,"address":[4227431],"length":1,"stats":{"Line":1},"fn_name":null},{"line":86,"address":[4227485,4227558],"length":1,"stats":{"Line":2},"fn_name":null},{"line":87,"address":[4227573,4227646],"length":1,"stats":{"Line":2},"fn_name":null},{"line":88,"address":[4227839,4227960],"length":1,"stats":{"Line":2},"fn_name":null},{"line":89,"address":[4230265,4227661,4227726,4227936],"length":1,"stats":{"Line":3},"fn_name":null},{"line":91,"address":[4228277,4228156],"length":1,"stats":{"Line":2},"fn_name":null},{"line":92,"address":[4228043,4230306,4227975,4228253],"length":1,"stats":{"Line":3},"fn_name":null},{"line":94,"address":[4228284,4228360],"length":1,"stats":{"Line":2},"fn_name":null},{"line":95,"address":[4228395],"length":1,"stats":{"Line":1},"fn_name":null},{"line":97,"address":[4228754,4228488],"length":1,"stats":{"Line":1},"fn_name":null},{"line":98,"address":[4228727,4229026,4228795],"length":1,"stats":{"Line":2},"fn_name":null},{"line":99,"address":[4228999,4229204,4229074],"length":1,"stats":{"Line":2},"fn_name":null},{"line":100,"address":[4229695,4229174,4229565],"length":1,"stats":{"Line":2},"fn_name":null},{"line":101,"address":[4229665,4230013,4230166],"length":1,"stats":{"Line":2},"fn_name":null}],"covered":67,"coverable":67}]};
    </script>
    <script crossorigin src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
    <script>const e = React.createElement;

function pathToString(path) {
  if (path[0] === '/') {
    return '/' + path.slice(1).join('/');
  } else {
    return path.join('/');
  }
}

function findCommonPath(files) {
  if (!files || !files.length) {
    return [];
  }

  function isPrefix(arr, prefix) {
    if (arr.length < prefix.length) {
      return false;
    }
    for (let i = prefix.length - 1; i >= 0; --i) {
      if (arr[i] !== prefix[i]) {
        return false;
      }
    }
    return true;
  }

  let commonPath = files[0].path.slice(0, -1);
  while (commonPath.length) {
    if (files.every(file => isPrefix(file.path, commonPath))) {
      break;
    }
    commonPath.pop();
  }
  return commonPath;
}

function findFolders(files) {
  if (!files || !files.length) {
    return [];
  }

  let folders = files.filter(file => file.path.length > 1).map(file => file.path[0]);
  folders = [...new Set(folders)]; // unique
  folders.sort();

  folders = folders.map(folder => {
    let filesInFolder = files
      .filter(file => file.path[0] === folder)
      .map(file => ({
        ...file,
        path: file.path.slice(1),
        parent: [...file.parent, file.path[0]],
      }));

    const children = findFolders(filesInFolder); // recursion

    return {
      is_folder: true,
      path: [folder],
      parent: files[0].parent,
      children,
      covered: children.reduce((sum, file) => sum + file.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.coverable, 0),
      prevRun: {
        covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
        coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
      }
    };
  });

  return [
    ...folders,
    ...files.filter(file => file.path.length === 1),
  ];
}

class App extends React.Component {
  constructor(...args) {
    super(...args);

    this.state = {
      current: [],
    };
  }

  componentDidMount() {
    this.updateStateFromLocation();
    window.addEventListener("hashchange", () => this.updateStateFromLocation(), false);
  }

  updateStateFromLocation() {
    if (window.location.hash.length > 1) {
      const current = window.location.hash.substr(1).split('/');
      this.setState({current});
    } else {
      this.setState({current: []});
    }
  }

  getCurrentPath() {
    let file = this.props.root;
    let path = [file];
    for (let p of this.state.current) {
      file = file.children.find(file => file.path[0] === p);
      if (!file) {
        return path;
      }
      path.push(file);
    }
    return path;
  }

  render() {
    const path = this.getCurrentPath();
    const file = path[path.length - 1];

    let w = null;
    if (file.is_folder) {
      w = e(FilesList, {
        folder: file,
        onSelectFile: this.selectFile.bind(this),
        onBack: path.length > 1 ? this.back.bind(this) : null,
      });
    } else {
      w = e(DisplayFile, {
        file,
        onBack: this.back.bind(this),
      });
    }

    return e('div', {className: 'app'}, w);
  }

  selectFile(file) {
    this.setState(({current}) => {
      return {current: [...current, file.path[0]]};
    }, () => this.updateHash());
  }

  back(file) {
    this.setState(({current}) => {
      return {current: current.slice(0, current.length - 1)};
    }, () => this.updateHash());
  }

  updateHash() {
    if (!this.state.current || !this.state.current.length) {
      window.location = '#';
    } else {
      window.location = '#' + this.state.current.join('/');
    }
  }
}

function FilesList({folder, onSelectFile, onBack}) {
  let files = folder.children;
  return e('div', {className: 'display-folder'},
    e(FileHeader, {file: folder, onBack}),
    e('table', {className: 'files-list'},
      e('thead', {className: 'files-list__head'},
        e('tr', null,
          e('th', null, "Path"),
          e('th', null, "Coverage")
        )
      ),
      e('tbody', {className: 'files-list__body'},
        files.map(file => e(File, {file, onClick: onSelectFile}))
      )
    )
  );
}

function File({file, onClick}) {
  const coverage = file.coverable ? file.covered / file.coverable * 100 : -1;
  const coverageDelta = file.prevRun &&
    (file.covered / file.coverable * 100 - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('tr', {
      className: 'files-list__file'
        + (coverage >= 0 && coverage < 50 ? ' files-list__file_low': '')
        + (coverage >= 50 && coverage < 80 ? ' files-list__file_medium': '')
        + (coverage >= 80 ? ' files-list__file_high': '')
        + (file.is_folder ? ' files-list__file_folder': ''),
      onClick: () => onClick(file),
    },
    e('td', null, pathToString(file.path)),
    e('td', null,
      file.covered + ' / ' + file.coverable +
      (coverage >= 0 ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function DisplayFile({file, onBack}) {
  return e('div', {className: 'display-file'},
    e(FileHeader, {file, onBack}),
    e(FileContent, {file})
  );
}

function FileHeader({file, onBack}) {
  const coverage = file.covered / file.coverable * 100;
  const coverageDelta = file.prevRun && (coverage - file.prevRun.covered / file.prevRun.coverable * 100);

  return e('div', {className: 'file-header'},
    onBack ? e('a', {className: 'file-header__back', onClick: onBack}, 'Back') : null,
    e('div', {className: 'file-header__name'}, pathToString([...file.parent, ...file.path])),
    e('div', {className: 'file-header__stat'},
      'Covered: ' + file.covered + ' of ' + file.coverable +
      (file.coverable ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e('span', {title: 'Change from the previous run'},
        (coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : ''))
    )
  );
}

function FileContent({file}) {
  return e('div', {className: 'file-content'},
    file.content.split(/\r?\n/).map((line, index) => {
      const trace = file.traces.find(trace => trace.line === index + 1);
      const covered = trace && trace.stats.Line;
      const uncovered = trace && !trace.stats.Line;
      return e('pre', {
          className: 'code-line'
            + (covered ? ' code-line_covered' : '')
            + (uncovered ? ' code-line_uncovered' : ''),
          title: trace ? JSON.stringify(trace.stats, null, 2) : null,
        }, line);
    })
  );
}

(function(){
  const commonPath = findCommonPath(data.files);
  const prevFilesMap = new Map();

  previousData && previousData.files.forEach((file) => {
    const path = file.path.slice(commonPath.length).join('/');
    prevFilesMap.set(path, file);
  });

  const files = data.files.map((file) => {
    const path = file.path.slice(commonPath.length);
    const { covered = 0, coverable = 0 } = prevFilesMap.get(path.join('/')) || {};
    return {
      ...file,
      path,
      parent: commonPath,
      prevRun: { covered, coverable },
    };
  });

  const children = findFolders(files);

  const root = {
    is_folder: true,
    children,
    path: commonPath,
    parent: [],
    covered: children.reduce((sum, file) => sum + file.covered, 0),
    coverable: children.reduce((sum, file) => sum + file.coverable, 0),
    prevRun: {
      covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
    }
  };

  ReactDOM.render(e(App, {root, prevFilesMap}), document.getElementById('root'));
}());
</script>
</body>
</html>